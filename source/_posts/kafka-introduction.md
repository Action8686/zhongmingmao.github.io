---
title: Kafka读书笔记 -- 初识Kafka
date: 2018-10-05 23:29:21
categories:
  - Kafka
tags:
  - Kafka
---

### 1 相关概念
1. Kafka一般被称为『分布式提交日志』或者『分布式流平台』
2. 文件系统或数据库提交日志用来提供所有事务的持久记录，通过重放这些日志可以重建系统的状态
  - Kafka的数据是按照一定顺序持久化保存的，可以按需读取
3. Kafka的数据分布在整个系统里，具备数据故障保护和性能伸缩能力

<!-- more -->

#### 1.1 消息和批次
1. Kafka的数据单元被称为消息
2. 消息由**字节数组**组成，消息里的数据没有特别的格式或者含义
3. 消息可以有一个可选的**元数据**，就是键，键也是一个**字节数组**，同样没有特殊含义
  - 消息以**一种可控的方式写入不同的分区**时，会用到键
  - 例如为键生成一个一致性散列值，然后使用散列值对主题分区数进行取模，为消息选取分区，从而保证具有相同键的消息总是被写入到相同的分区
4. 为了提高效率，消息被**分批**写入Kafka，**批次就是一组消息**，这些消息**属于同一个主题和分区**
  - 如果每个消息都单独穿行于网络，会导致大量的网络开销，把消息分成批次传输可以减少网络开销
  - 不过，这需要在**时间延迟**和**吞吐量**之间做出权衡：批次越大，单位时间内处理的消息就会越多，耽搁消息的传输时间就会越长
  - 批次数据会被**压缩**，这样可以提升数据的传输和存储能力，但要做更多的计算处理

#### 1.2 模式
1. 对于Kafka来说，消息不过是晦涩难懂的字节数组
2. 依据应用程序的需求，**消息模式** 有许多可用的选项
3. 像JSON和XML这些简单的系统，不仅易用，而且可读性好；但是**缺乏强类型的处理能力**，不同版本之间的**兼容性也不好**
4. Kafka的许多开发者喜欢使用**Apache Avro**，它最初是为了Hadoop开发的一款序列化框架
  - Avro提供了一种**紧凑的序列化格式**，**模式和消息体是分开的，当模式发生变化时，不需要重新生成代码**
  - Avro还支持**强类型**和**模式进化**，其版本既向前兼容，也向后兼容
5. **数据格式的一致性**对于Kafka来说很重要，它**消除了消息读写操作之间的耦合性**
  - 如果读写操作紧密地耦合在一起，消息订阅者需要升级应用程序才能同时处理新旧两种数据格式
  - 在消息订阅者升级之后，消息发布者才能跟着升级，以便使用新的数据格式
  - 新的应用程序如果需要使用数据，就要和消息发布者发生耦合，导致开发者需要做很多繁杂的工作
6. 定义良好的格式，并把它们存放在**公共仓库**，可以方便我们理解**Kafka的消息结构**

#### 1.3 主题和分区
1. Kafka的消息通过**主题**进行分类，主题类似于数据库的表，或者文件系统里的文件夹
2. **主题可以被分为若干个分区，一个分区就是一个提交日志**
3. 消息以**追加**的方式写入分区，然后以**FIFO**的顺序读取
4. 由于一个主题一般包含几个分区，因此**无法在整个主题范围内保证消息的顺序**，但可以保证消息在单个分区内的顺序
5. Kafka通过分区来实现**数据冗余**和**伸缩性**
  - **分区可以分布在不同的服务器上，因此一个主题可以横跨多个服务器**
6. 很多时候，会把一个**主题的数据**看成一个**流**，不管它有多少个分区
  - **流是一组从生产者移动到消费者的数据**

![topic.png](http://pg67n0yz6.bkt.clouddn.com/topic.png)

<!-- indicate-the-source -->
