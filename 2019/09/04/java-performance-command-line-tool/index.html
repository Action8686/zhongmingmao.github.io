<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">





  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">





  <meta name="msvalidate.01" content="1699A46CB5242072D8403C073F576423">







  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/fancybox@3/dist/css/jquery.fancybox.min.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/dragon/dragon-apple-touch-icon.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/dragon/dragon-favicon-32x32.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/dragon/dragon-favicon-16x16.png?v=7.1.2">


  <link rel="mask-icon" href="/images/dragon/dragon-logo.svg?v=7.1.2" color="#222">



  <meta name="msapplication-config" content="/images/dragon/dragon-browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.2',
    sidebar: {"position":"right","width":180,"display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-/+ buffers/cache:       8880">
<meta name="keywords" content="Java,Java Performance">
<meta property="og:type" content="article">
<meta property="og:title" content="Java性能 -- 命令行工具">
<meta property="og:url" content="http://zhongmingmao.me/2019/09/04/java-performance-command-line-tool/index.html">
<meta property="og:site_name" content="点滴积累">
<meta property="og:description" content="free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-/+ buffers/cache:       8880">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-30T05:35:06.466Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java性能 -- 命令行工具">
<meta name="twitter:description" content="free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-/+ buffers/cache:       8880">



  <link rel="alternate" href="/atom.xml" title="点滴积累" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://zhongmingmao.me/2019/09/04/java-performance-command-line-tool/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Java性能 -- 命令行工具 | 点滴积累</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97268729-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-97268729-1');
    }
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fad94c1137504ba7685443e9d1f2abe9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">点滴积累</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">127</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">38</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">352</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhongmingmao.me/2019/09/04/java-performance-command-line-tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhongmingmao">
      <meta itemprop="description" content="懦夫从不启程">
      <meta itemprop="image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/dog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点滴积累">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Java性能 -- 命令行工具

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-04 19:48:26" itemprop="dateCreated datePublished" datetime="2019-09-04T19:48:26+08:00">2019-09-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/performance/" itemprop="url" rel="index"><span itemprop="name">Performance</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/09/04/java-performance-command-line-tool/" class="leancloud_visitors" data-flag-title="Java性能 -- 命令行工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">19k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">34 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:         15948      15261        687        304         37       6343</span><br><span class="line">-/+ buffers/cache:       8880       7068</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<ol>
<li><code>Mem</code>是从<strong>操作系统</strong>的角度来看的<ul>
<li>总共有15948M物理内存，其中15261M被使用了，还有687可用，<code>15948 = 15261 + 687</code></li>
<li>有若干线程共享了304M物理内存，已经被弃用（值总为0）</li>
<li>buffer / cached ：为了<strong>提高IO性能</strong>，由OS管理<ul>
<li>A buffer is something that has yet to be <strong>“written”</strong> to disk.</li>
<li>A cache is something that has been <strong>“read”</strong> from the disk and stored for later use.</li>
<li>buffer和cached占用的内存可以<strong>被快速回收</strong></li>
</ul>
</li>
</ul>
</li>
<li><code>-/+ buffers/cache</code>是从<strong>应用程序</strong>的角度来看的<ul>
<li>应用程序认为系统被用掉了8880M物理内存，还剩下7068M物理内存</li>
<li><code>8880 ≈ (15261 - 37 - 6343 = 8881)</code></li>
<li><code>7068 ≈ (687 + 37 + 6343 = 7067)</code></li>
</ul>
</li>
</ol>
<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ top -v</span><br><span class="line">	top: procps version 3.2.8</span><br><span class="line">usage:	top -hv | -abcHimMsS -d delay -n iterations [-u user | -U user] -p pid [,pid ...]</span><br><span class="line"></span><br><span class="line">$ top</span><br><span class="line">top - 09:08:28 up 36 days, 13:19,  1 user,  load average: 0.31, 0.16, 0.11</span><br><span class="line">Tasks: 274 total,   1 running, 273 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s):  2.5%us,  1.6%sy,  0.0%ni, 95.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Mem:  16331512k total, 16141616k used,   189896k free,     5372k buffers</span><br><span class="line">Swap:        0k total,        0k used,        0k free,  7526888k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+   PPID RUSER     UID GROUP    TTY      P SWAP   TIME CODE DATA nFLT nDRT WCHAN     Flags    COMMAND</span><br><span class="line">21862 dc        20   0 5113m 551m 5096 S  0.0  3.5  25:34.77     1 dc        555 dc       ?        4    0  25:34    4 4.8g  13k    0 futex_wai ..4.2... java</span><br><span class="line">12692 dc        20   0 5109m 513m 5792 S  0.2  3.2  19:54.09     1 dc        555 dc       ?        2    0  19:54    4 4.8g  30k    0 futex_wai ..4.2... java</span><br><span class="line">20299 dc        20   0 5054m 508m 2644 S  0.0  3.2 179:37.25     1 dc        555 dc       ?        4    0 179:37    4 4.8g  65k    0 futex_wai ..4.2... java</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol>
<li>top命令可以实时显示正在执行进程的<strong>CPU使用率</strong>、<strong>内存使用率</strong>以及<strong>系统负载</strong>等信息<ul>
<li>上半部分显示的是<strong>系统的统计信息</strong>，下半部分显示的是<strong>进程的使用率统计信息</strong></li>
</ul>
</li>
<li>系统的统计信息<ul>
<li>Cpu<ul>
<li>%us：用户空间占用CPU百分比</li>
<li>%sy：内核空间占用CPU百分比</li>
<li>%ni：用户进程空间内<strong>改变过优先级</strong>的进程占用CPU百分比</li>
<li>%id：<strong>空闲</strong>CPU百分比</li>
<li>%wa：<strong>等待输入输出</strong>的CPU时间百分比</li>
<li>%hi：<strong>硬件中断</strong>占用百分比</li>
<li>%si：<strong>软中断</strong>占用百分比</li>
<li>%st：<strong>虚拟机</strong>占用百分比</li>
</ul>
</li>
</ul>
</li>
<li>进程的使用率统计信息<ul>
<li><strong>PID</strong>: Process Id<ul>
<li>The task’s unique process ID, which periodically wraps, though never restarting at zero.</li>
</ul>
</li>
<li><strong>PPID</strong>: Parent Process Pid<ul>
<li>The process ID of a task’s parent.</li>
</ul>
</li>
<li><strong>RUSER</strong>: Real User Name<ul>
<li>The real user name of the task’s owner.</li>
</ul>
</li>
<li><strong>UID</strong>: User Id<ul>
<li>The effective user ID of the task’s owner.</li>
</ul>
</li>
<li><strong>USER</strong>: User Name<ul>
<li>The effective user name of the task’s owner.</li>
</ul>
</li>
<li><strong>GROUP</strong>: Group Name<ul>
<li>The effective group name of the task’s owner.</li>
</ul>
</li>
<li><strong>TTY</strong>: Controlling Tty<ul>
<li>The name of the controlling terminal. This is usually the device (serial port, pty, etc.) from which the process was started, and which it uses for input or output. However, a task <strong>need not be associated with a terminal</strong>, in which case you’ll see <strong><code>&#39;?&#39;</code></strong> displayed.</li>
</ul>
</li>
<li><strong>%CPU</strong>: CPU usage<ul>
<li>The task’s share of the elapsed CPU time since the last screen update, expressed as a percentage of total CPU time.</li>
<li>In a true SMP environment, if ‘Irix mode’ is Off, top will operate in ‘Solaris mode’ where a task’s cpu usage will be divided by the total number of CPUs. You toggle ‘Irix/Solaris’ modes with the ‘I’ interactive command.</li>
</ul>
</li>
<li><strong>S</strong>: Process Status<ul>
<li>The status of the task which can be one of<ul>
<li><code>&#39;D&#39; = uninterruptible sleep</code></li>
<li><code>&#39;R&#39; = running</code></li>
<li><code>&#39;S&#39; = sleeping</code></li>
<li><code>&#39;T&#39; = traced or stopped</code></li>
<li><code>&#39;Z&#39; = zombie</code></li>
</ul>
</li>
<li>Tasks shown as <strong>running</strong> should be more properly thought of as <strong><code>ready to run</code></strong><ul>
<li>their task_struct is simply represented on the Linux <strong>run-queue</strong>.</li>
<li>Even without a true SMP machine, you may see numerous tasks in this state depending on top’s <strong>delay interval</strong> and <strong>nice value</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong>P</strong>: Last used CPU (SMP)<ul>
<li>A number representing the last used processor. In a true SMP environment this will likely change frequently since the kernel intentionally uses weak affinity. Also, the very act of running top may break this weak affinity and cause more processes to change CPUs more often (because of the extra demand for cpu time).</li>
</ul>
</li>
<li><strong>PR</strong>: Priority<ul>
<li>The priority of the task.</li>
</ul>
</li>
<li><strong>NI</strong>: Nice value<ul>
<li>The nice value of the task.</li>
<li>A <strong>negative nice value</strong> means <strong>higher priority</strong>, whereas a <strong>positive nice value</strong> means <strong>lower priority</strong>.</li>
<li><strong>Zero</strong> in this field simply means <strong>priority will not be adjusted</strong> in determining a task’s dispatchability.</li>
</ul>
</li>
<li><strong>TIME</strong>: CPU Time<ul>
<li>Total CPU time the task has used since it started.</li>
</ul>
</li>
<li><strong>TIME+</strong>: CPU Time, hundredths<ul>
<li>The same as ‘TIME’, but reflecting more granularity through <strong>hundredths of a second</strong>.</li>
</ul>
</li>
<li><strong>%MEM</strong>: Memory usage (RES)<ul>
<li>A task’s currently used share of <strong>available physical memory</strong>.</li>
</ul>
</li>
<li><strong>RES</strong>: Resident size (kb)<ul>
<li>The <strong>non-swapped physical memory</strong> a task has used.</li>
<li><em><strong>RES = CODE + DATA</strong></em>.</li>
</ul>
</li>
<li><strong>CODE</strong>: Code size (kb)<ul>
<li>The amount of <strong>physical memory</strong> devoted to <strong>executable code</strong>, also known as the <strong><code>&#39;text resident set&#39;</code></strong> size or <strong>TRS</strong>.</li>
</ul>
</li>
<li><strong>DATA</strong>: Data+Stack size (kb)<ul>
<li>The amount of <strong>physical memory</strong> devoted to <strong>other than executable code</strong>, also known as the <strong><code>&#39;data resident set&#39;</code></strong> size or <strong>DRS</strong>.</li>
</ul>
</li>
<li><strong>SWAP</strong>: Swapped size (kb)<ul>
<li>Per-process swap values are now taken from <strong>/proc/#/status VmSwap field</strong>.</li>
</ul>
</li>
<li><strong>VIRT</strong>: Virtual Image (kb)<ul>
<li>The <strong>total amount of virtual memory</strong> used by the task.</li>
<li>It includes all <strong>code</strong>, <strong>data</strong> and <strong>shared libraries</strong> plus <strong>pages that have been swapped out</strong>.</li>
</ul>
</li>
<li><strong>SHR</strong>: Shared Mem size (kb)<ul>
<li>The <strong>amount of shared memory</strong> used by a task.</li>
<li>It simply reflects memory that could be potentially shared with other processes.</li>
</ul>
</li>
<li><strong>nFLT</strong>: Page Fault count<ul>
<li>The number of <strong>major page faults</strong> that have occurred for a task. A page fault occurs when a process attempts to <strong>read from or write to a virtual page that is not currently present in its address space</strong>. A major page fault is when <strong>disk access</strong> is involved in making that page available.</li>
</ul>
</li>
<li><strong>nDRT</strong>: Dirty Pages count<ul>
<li>The number of pages that have been modified since they were last written to disk. <strong>Dirty pages must be written to disk before the corresponding physical memory location can be used for some other virtual page</strong>.</li>
</ul>
</li>
<li><strong>WCHAN</strong>: Sleeping in Function<ul>
<li>Depending on the availability of the kernel link map (‘System.map’), this field will show the name or the address of the <strong>kernel function</strong> in which the task is currently sleeping. Running tasks will display a dash (‘-‘) in this column.</li>
</ul>
</li>
<li><strong>Flags</strong>: Task Flags<ul>
<li>This column represents the task’s current scheduling flags which are expressed in hexadecimal notation and with zeros suppressed.</li>
</ul>
</li>
<li><strong>COMMAND</strong>: Command line or Program name</li>
</ul>
</li>
<li>常用选项<ul>
<li><strong>-a : Sort by memory usage</strong><ul>
<li>This switch makes top to sort the processes by <strong>allocated memory</strong></li>
</ul>
</li>
<li><strong>-d : Delay time</strong> interval as: <strong>-d ss.tt</strong> (seconds.tenths)<ul>
<li>Specifies the delay between screen updates, and overrides the corresponding value in one’s personal configuration file or the startup default.</li>
<li>Later this can be changed with the <strong><code>&#39;d&#39;</code></strong> or <strong><code>&#39;s&#39;</code></strong> <strong>interactive commands</strong>.</li>
</ul>
</li>
<li><strong>-H : Threads</strong> toggle<ul>
<li>When this toggle is On, all <strong>individual threads</strong> will be displayed. Otherwise, top displays <strong>a summation of all threads in a process</strong>.</li>
</ul>
</li>
<li><strong>-M : Detect memory units</strong><ul>
<li>Show memory units (<strong>k/M/G</strong>) and display floating point values in the memory summary.</li>
</ul>
</li>
<li><strong>-n : Number of iterations</strong> limit as: <strong>-n number</strong><ul>
<li>Specifies the <strong>maximum number of iterations</strong>, or frames, top should produce before ending</li>
</ul>
</li>
<li><strong>-p : Monitor PIDs</strong> as: <strong>-pN1 -pN2</strong> … or <strong>-pN1, N2 [,…]</strong><ul>
<li>Monitor only processes with specified process IDs. This option can be given up to <strong>20</strong> times, or you can provide a <strong>comma</strong> delimited list with up to 20 pids. <strong>Co-mingling</strong> both approaches is <strong>permitted</strong>.</li>
<li>This is a command-line option only. And should you wish to <strong>return to normal operation</strong>, it is not necessary to quit and and restart top – just issue the <strong>‘=’ interactive command</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>交互命令<ul>
<li><strong><code>P</code></strong>： 根据<strong>CPU</strong>资源使用大小进行排序</li>
<li><strong><code>M</code></strong>： 根据<strong>内存</strong>资源使用大小进行排序</li>
<li><code>T</code>： 根据进程使用<strong>CPU的累积时间</strong>排序</li>
<li><code>N</code>： 按PID由高到低排列</li>
<li><code>r</code>： 修改进程的nice值(优先级)。优先级默认为10，正值使优先级降低，反之则提高的优先级</li>
<li><code>S</code>： 累计模式（把已完成或退出的子进程占用的CPU时间累计到<strong>父进程</strong>的TIME+ ）</li>
<li><code>W</code>： 将当前设置写入~/.toprc文件，下次启动自动调用toprc文件的设置</li>
<li><code>&lt;</code>： 向前翻页</li>
<li><code>&gt;</code>： 向后翻页</li>
<li><code>1</code>： 显示每个CPU的详细情况</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Help for Interactive Commands - procps version 3.2.8</span><br><span class="line">Window 1:Def: Cumulative mode Off.  System: Delay 3.0 secs; Secure mode Off.</span><br><span class="line"></span><br><span class="line">  Z,B       Global: &apos;Z&apos; change color mappings; &apos;B&apos; disable/enable bold</span><br><span class="line">  l,t,m     Toggle Summaries: &apos;l&apos; load avg; &apos;t&apos; task/cpu stats; &apos;m&apos; mem info</span><br><span class="line">  1,I       Toggle SMP view: &apos;1&apos; single/separate states; &apos;I&apos; Irix/Solaris mode</span><br><span class="line"></span><br><span class="line">  f,o     . Fields/Columns: &apos;f&apos; add or remove; &apos;o&apos; change display order</span><br><span class="line">  F or O  . Select sort field</span><br><span class="line">  &lt;,&gt;     . Move sort field: &apos;&lt;&apos; next col left; &apos;&gt;&apos; next col right</span><br><span class="line">  R,H     . Toggle: &apos;R&apos; normal/reverse sort; &apos;H&apos; show threads</span><br><span class="line">  c,i,S   . Toggle: &apos;c&apos; cmd name/line; &apos;i&apos; idle tasks; &apos;S&apos; cumulative time</span><br><span class="line">  x,y     . Toggle highlights: &apos;x&apos; sort field; &apos;y&apos; running tasks</span><br><span class="line">  z,b     . Toggle: &apos;z&apos; color/mono; &apos;b&apos; bold/reverse (only if &apos;x&apos; or &apos;y&apos;)</span><br><span class="line">  u       . Show specific user only</span><br><span class="line">  n or #  . Set maximum tasks displayed</span><br><span class="line"></span><br><span class="line">  k,r       Manipulate tasks: &apos;k&apos; kill; &apos;r&apos; renice</span><br><span class="line">  d or s    Set update interval</span><br><span class="line">  W         Write configuration file</span><br><span class="line">  q         Quit</span><br><span class="line">          ( commands shown with &apos;.&apos; require a visible task display window )</span><br><span class="line">Press &apos;h&apos; or &apos;?&apos; for help with Windows,</span><br><span class="line">any other key to continue</span><br></pre></td></tr></table></figure>

<h2 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ vmstat -S M 1 5</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 2  0      0    295      1   5684    0    0     8    23    1    2  5  1 93  0  0</span><br><span class="line"> 0  0      0    295      1   5684    0    0     0     0 11326 25112  6  5 90  0  0</span><br><span class="line"> 0  0      0    295      1   5685    0    0     0     0 10855 24065  2  2 96  0  0</span><br><span class="line"> 0  0      0    294      1   5686    0    0     0     4 11756 25472  4  2 94  0  0</span><br><span class="line"> 0  0      0    294      1   5686    0    0     0     0 10208 22726  4  4 91  0  0</span><br><span class="line"></span><br><span class="line">$ free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:         15948      15655        293       5362          1       5687</span><br><span class="line">-/+ buffers/cache:       9966       5981</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>

<ol>
<li>vmstat是一款指定采样周期和次数的<strong>功能性监控工具</strong>，可以用来监控进程上下文切换的情况</li>
<li>procs<ul>
<li>r: The number of <strong>runnable</strong> processes (<strong>running</strong> or <strong>waiting</strong> for run time)</li>
<li>b: The number of processes in <strong>uninterruptible sleep</strong></li>
</ul>
</li>
<li>memory<ul>
<li>swpd: the amount of <strong>virtual</strong> memory used</li>
<li>free: the amount of <strong>idle</strong> memory</li>
<li>buff: the amount of memory used as <strong>buffers</strong></li>
<li>cache: the amount of memory used as <strong>cache</strong></li>
</ul>
</li>
<li>swap<ul>
<li>si: Amount of memory <strong>swapped in from disk</strong> (/s)</li>
<li>so: Amount of memory <strong>swapped to</strong> disk (/s)</li>
</ul>
</li>
<li>io<ul>
<li>bi: Blocks <strong>received</strong> from a block device (blocks/s)</li>
<li>bo: Blocks <strong>sent</strong> to a block device (blocks/s)</li>
</ul>
</li>
<li>system<ul>
<li>in: The number of <strong>interrupts</strong> per second, including the clock</li>
<li>cs: The number of <strong>context switches</strong> per second</li>
</ul>
</li>
<li>cpu<ul>
<li>us: Time spent running <strong>non-kernel code</strong></li>
<li>sy: Time spent running <strong>kernel code</strong></li>
<li>id: Time spent idle, this <strong>includes IO-wait time</strong></li>
<li>wa: Time spent waiting for IO, <strong>included in idle</strong></li>
<li>st: Time stolen from a virtual machine</li>
</ul>
</li>
</ol>
<h2 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h2><ol>
<li>pidstat可以监测到<strong>具体线程的上下文切换</strong>，pidstat是<strong>sysstat</strong>中的一个组件</li>
<li>常用参数<ul>
<li><code>-u</code>: Report <strong>CPU utilization</strong></li>
<li><code>-r</code>: Report <strong>page faults</strong> and <strong>memory utilization</strong></li>
<li><code>-d</code>: Report <strong>I/O statistics</strong></li>
<li><code>-w</code>: Report <strong>task switching activity</strong></li>
<li><code>-t</code>: Also display <strong>statistics for threads</strong> associated with selected tasks</li>
<li><code>-p { pid [,...] | SELF | ALL }</code>: Select tasks (processes) for which statistics are to be reported</li>
</ul>
</li>
</ol>
<h3 id="CPU使用率"><a href="#CPU使用率" class="headerlink" title="CPU使用率"></a>CPU使用率</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -u -p 4256 1 3</span><br><span class="line">Linux 2.6.32-696.el6.x86_64 (XXXX) 	2019年XX月XX日 	_x86_64_	(32 CPU)</span><br><span class="line"></span><br><span class="line">22时59分32秒       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">22时59分33秒      4256   71.00   13.00    0.00   84.00     1  java</span><br><span class="line">22时59分34秒      4256   60.00   10.00    0.00   70.00     1  java</span><br><span class="line">22时59分35秒      4256   76.24   12.87    0.00   89.11     1  java</span><br><span class="line">平均时间:      4256   69.10   11.96    0.00   81.06     -  java</span><br><span class="line"></span><br><span class="line">$ pidstat -u -I -p 4256 1 3</span><br><span class="line">Linux 2.6.32-696.el6.x86_64 (XXXX) 	2019年XX月XX日 	_x86_64_	(32 CPU)</span><br><span class="line"></span><br><span class="line">23时06分18秒       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">23时06分19秒      4256   69.31   12.87    0.00    2.63     1  java</span><br><span class="line">23时06分20秒      4256   69.00   12.00    0.00    2.57     1  java</span><br><span class="line">23时06分21秒      4256   62.00   12.00    0.00    2.34     1  java</span><br><span class="line">平均时间:      4256   66.78   12.29    0.00    2.51     -  java</span><br></pre></td></tr></table></figure>

<ol>
<li>%usr<ul>
<li>Percentage of CPU used by the task while executing at the <strong>user level</strong> (<strong>application</strong>)</li>
<li>Note that this field does <strong>NOT include time spent running a virtual processor</strong></li>
</ul>
</li>
<li>%system<ul>
<li>Percentage of CPU used by the task while executing at the <strong>system level</strong> (<strong>kernel</strong>)</li>
</ul>
</li>
<li>%guest<ul>
<li>Percentage of CPU spent by the task in virtual machine (running a <strong>virtual processor</strong>)</li>
</ul>
</li>
<li>%CPU<ul>
<li><strong>Total percentage</strong> of CPU time used by the task</li>
<li>In an <strong>SMP</strong> environment, the task’s CPU usage will be <strong>divided</strong> by the <strong>total number of CPU’s</strong> if option <strong>-I</strong> has been entered on the command line</li>
</ul>
</li>
<li>CPU<ul>
<li><strong>Processor number</strong> to which the task is attached</li>
</ul>
</li>
</ol>
<h3 id="页错误-内存使用率"><a href="#页错误-内存使用率" class="headerlink" title="页错误 + 内存使用率"></a>页错误 + 内存使用率</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -r -p 4256 1 3</span><br><span class="line">23时11分26秒       PID  minflt/s  majflt/s     VSZ    RSS   %MEM  Command</span><br><span class="line">23时11分27秒      4256   2132.00      0.00 22427892 5172756   7.84  java</span><br><span class="line">23时11分28秒      4256   1623.00      0.00 22427892 5172728   7.84  java</span><br><span class="line">23时11分29秒      4256   1942.00      0.00 22427892 5172728   7.84  java</span><br><span class="line">平均时间:      4256   1899.00      0.00 22427892 5172737   7.84  java</span><br></pre></td></tr></table></figure>

<ol>
<li>minflt/s<ul>
<li>Total number of <strong>minor faults</strong> the task has made per second, those which have <strong>not required loading a memory page from disk</strong></li>
</ul>
</li>
<li>majflt/s<ul>
<li>Total number of <strong>major faults</strong> the task has made per second, those which have <strong>required loading a memory page from disk</strong></li>
</ul>
</li>
<li>VSZ<ul>
<li>Virtual Size: The <strong>virtual memory</strong> usage of entire task in <strong>kilobytes</strong></li>
</ul>
</li>
<li>RSS<ul>
<li>Resident Set Size: The <strong>non-swapped physical memory</strong> used by the task in <strong>kilobytes</strong></li>
</ul>
</li>
</ol>
<h3 id="IO统计"><a href="#IO统计" class="headerlink" title="IO统计"></a>IO统计</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -d -p 4256 1 3</span><br><span class="line">23时24分59秒       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command</span><br><span class="line">23时25分00秒      4256      0.00    408.00      0.00  java</span><br><span class="line">23时25分01秒      4256      0.00    356.44      0.00  java</span><br><span class="line">23时25分02秒      4256      0.00    375.76      0.00  java</span><br><span class="line">平均时间:      4256      0.00    380.00      0.00  java</span><br></pre></td></tr></table></figure>

<ol>
<li>kB_rd/s<ul>
<li>Number of <strong>kilobytes</strong> the task has caused to be <strong>read from disk</strong> per second</li>
</ul>
</li>
<li>kB_wr/s<ul>
<li>Number of <strong>kilobytes</strong> the task has caused, or shall cause to be <strong>written to disk</strong> per second</li>
</ul>
</li>
<li>kB_ccwr/s<ul>
<li>Number of <strong>kilobytes</strong> whose <strong>writing to disk</strong> has been <strong>cancelled</strong> by the task</li>
<li>This may occur when the task <strong>truncates some dirty pagecache</strong><ul>
<li>In this case, some IO which another task has been accounted for will <strong>not be happening</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="进程上下文切换"><a href="#进程上下文切换" class="headerlink" title="进程上下文切换"></a>进程上下文切换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -w -p 4256 1 3</span><br><span class="line">22时54分33秒       PID   cswch/s nvcswch/s  Command</span><br><span class="line">22时54分34秒      4256      0.00      0.00  java</span><br><span class="line">22时54分35秒      4256      0.00      0.00  java</span><br><span class="line">22时54分36秒      4256      0.00      0.00  java</span><br><span class="line">平均时间:      4256      0.00      0.00  java</span><br></pre></td></tr></table></figure>

<ol>
<li>cswch/s<ul>
<li>Total number of <strong>voluntary context switches</strong> the task made per second</li>
<li>A voluntary context switch occurs when a task blocks because it <strong>requires a resource that is unavailable</strong></li>
</ul>
</li>
<li>nvcswch/s<ul>
<li>Total number of <strong>non voluntary context switches</strong> the task made per second</li>
<li>A involuntary context switch takes place when a task executes for the duration of its <strong>time slice</strong> and then is <strong>forced to relinquish</strong> the processor</li>
</ul>
</li>
</ol>
<h3 id="线程上下文切换"><a href="#线程上下文切换" class="headerlink" title="线程上下文切换"></a>线程上下文切换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -w -t -p 4256 | head -n 10</span><br><span class="line"></span><br><span class="line">23时32分03秒      TGID       TID   cswch/s nvcswch/s  Command</span><br><span class="line">23时32分03秒      4256         -      0.00      0.00  java</span><br><span class="line">23时32分03秒         -      4256      0.00      0.00  |__java</span><br><span class="line">23时32分03秒         -      4259      0.00      0.00  |__java</span><br><span class="line">23时32分03秒         -      4306      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4307      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4308      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4315      0.04      0.01  |__java</span><br></pre></td></tr></table></figure>

<h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -options</span><br><span class="line">-class</span><br><span class="line">-compiler</span><br><span class="line">-gc</span><br><span class="line">-gccapacity</span><br><span class="line">-gccause</span><br><span class="line">-gcnew</span><br><span class="line">-gcnewcapacity</span><br><span class="line">-gcold</span><br><span class="line">-gcoldcapacity</span><br><span class="line">-gcpermcapacity</span><br><span class="line">-gcutil</span><br><span class="line">-printcompilation</span><br></pre></td></tr></table></figure>

<ol>
<li>class<ul>
<li>显示<strong>类加载</strong>的相关信息</li>
</ul>
</li>
<li>compiler<ul>
<li>显示<strong>JIT编译</strong>的相关信息</li>
</ul>
</li>
<li>gc<ul>
<li>显示和GC相关的堆信息    </li>
</ul>
</li>
<li>gccapacity<ul>
<li>显示各个代的容量以及使用情况</li>
</ul>
</li>
<li>gccause<ul>
<li>显示垃圾回收的相关信息，同时显示最后一次或当前正在发生的垃圾回收的诱因</li>
</ul>
</li>
<li>gcnew<ul>
<li>显示新生代信息</li>
</ul>
</li>
<li>gcnewcapacity<ul>
<li>显示新生代的大小和使用情况</li>
</ul>
</li>
<li>gcold<ul>
<li>显示老年代和永久代的信息</li>
</ul>
</li>
<li>gcoldcapacity<ul>
<li>显示老年代的大小</li>
</ul>
</li>
<li>gcpermcapacity<ul>
<li>显示永久代的大小</li>
</ul>
</li>
<li><em><strong>gcutil</strong></em><ul>
<li>显示垃圾收集信息</li>
</ul>
</li>
<li>printcompilation<ul>
<li>输出JIT编译的方法信息</li>
</ul>
</li>
</ol>
<h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><p>jstack可以查看<strong>线程堆栈</strong>的运行情况，可以结合<code>pidstat -t -p PID</code>来查看具体线程的<strong>状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /usr/local/java/bin/jstack -F 5850</span><br><span class="line">Thread 5853: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.Object.wait() @bci=2, line=503 (Interpreted frame)</span><br><span class="line"> - xx.xx.xx.service.client.proxy.Provider.start() @bci=889, line=208 (Interpreted frame)</span><br><span class="line"> - xx.xx.xx.xx.xx.main(java.lang.String[]) @bci=368, line=90 (Interpreted frame)</span><br></pre></td></tr></table></figure>

<h2 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h2><p>可以通过<code>jamp -heap</code>查看堆内存的<strong>初始化配置信息</strong>以及堆内存的<strong>使用情况</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap 23594</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Garbage-First (G1) GC with 12 thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio = 40</span><br><span class="line">   MaxHeapFreeRatio = 70</span><br><span class="line">   MaxHeapSize      = 268435456 (256.0MB)</span><br><span class="line">   NewSize          = 1363144 (1.2999954223632812MB)</span><br><span class="line">   MaxNewSize       = 17592186044415 MB</span><br><span class="line">   OldSize          = 5452592 (5.1999969482421875MB)</span><br><span class="line">   NewRatio         = 2</span><br><span class="line">   SurvivorRatio    = 8</span><br><span class="line">   PermSize         = 134217728 (128.0MB)</span><br><span class="line">   MaxPermSize      = 134217728 (128.0MB)</span><br><span class="line">   G1HeapRegionSize = 4194304 (4.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">G1 Heap:</span><br><span class="line">   regions  = 64</span><br><span class="line">   capacity = 268435456 (256.0MB)</span><br><span class="line">   used     = 159804896 (152.40182495117188MB)</span><br><span class="line">   free     = 108630560 (103.59817504882812MB)</span><br><span class="line">   59.531962871551514% used</span><br><span class="line">G1 Young Generation:</span><br><span class="line">Eden Space:</span><br><span class="line">   regions  = 27</span><br><span class="line">   capacity = 163577856 (156.0MB)</span><br><span class="line">   used     = 113246208 (108.0MB)</span><br><span class="line">   free     = 50331648 (48.0MB)</span><br><span class="line">   69.23076923076923% used</span><br><span class="line">Survivor Space:</span><br><span class="line">   regions  = 1</span><br><span class="line">   capacity = 4194304 (4.0MB)</span><br><span class="line">   used     = 4194304 (4.0MB)</span><br><span class="line">   free     = 0 (0.0MB)</span><br><span class="line">   100.0% used</span><br><span class="line">G1 Old Generation:</span><br><span class="line">   regions  = 12</span><br><span class="line">   capacity = 100663296 (96.0MB)</span><br><span class="line">   used     = 42364384 (40.401824951171875MB)</span><br><span class="line">   free     = 58298912 (55.598175048828125MB)</span><br><span class="line">   42.08523432413737% used</span><br><span class="line">Perm Generation:</span><br><span class="line">   capacity = 134217728 (128.0MB)</span><br><span class="line">   used     = 43099600 (41.10298156738281MB)</span><br><span class="line">   free     = 91118128 (86.89701843261719MB)</span><br><span class="line">   32.11170434951782% used</span><br><span class="line"></span><br><span class="line">16133 interned Strings occupying 1421648 bytes.</span><br></pre></td></tr></table></figure>

<p>可以通过<code>jamp -histo[:live]</code>查看堆内存中的<strong>对象数目、大小统计直方图</strong>，live只统计<strong>存活对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -histo -F 23594 | head</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line">Iterating over heap. This may take a while...</span><br><span class="line">Object Histogram:</span><br><span class="line"></span><br><span class="line">num 	  #instances	#bytes	Class description</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">1:		9547	24873832	int[]</span><br><span class="line">2:		78517	11010880	* ConstMethodKlass</span><br><span class="line">3:		78517	10062240	* MethodKlass</span><br><span class="line">4:		7196	8222752	* ConstantPoolKlass</span><br><span class="line">5:		187123	7484920	java.util.HashMap$EntryIterator</span><br><span class="line">6:		43559	6833504	char[]</span><br><span class="line">Heap traversal took 33.612 seconds.</span><br></pre></td></tr></table></figure>

<p>可以通过<code>jmap -dump:format=b,file=/tmp/heap.hprof</code>把<strong>堆内存的使用情况</strong>dump到文件中，随后通过<strong>MAT</strong>工具进行分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -dump:format=b,file=/tmp/wall.hprof -F 23594</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line">Dumping heap to /tmp/wall.hprof ...</span><br><span class="line">Heap dump file created</span><br><span class="line"></span><br><span class="line">$ du -sh /tmp/wall.hprof</span><br><span class="line">231M	/tmp/wall.hprof</span><br></pre></td></tr></table></figure>
      
    </div>

    
      

  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/06/26/java-performance-arraylist-linkedlist/" rel="bookmark">Java性能 -- ArrayList + LinkedList</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/08/20/java-performance-cas/" rel="bookmark">Java性能 --  CAS乐观锁</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/08/30/java-performance-concurrent-container/" rel="bookmark">Java性能 -- 并发容器</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/09/21/java-performance-concurrent-design-pattern/" rel="bookmark">Java性能 -- 并发设计模式</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/09/05/java-performance-consistency/" rel="bookmark">Java性能 -- 并发一致性</a></div>
      
    </li>
  
  </ul>


    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>zhongmingmao</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://zhongmingmao.me/2019/09/04/java-performance-command-line-tool/" title="Java性能 -- 命令行工具">http://zhongmingmao.me/2019/09/04/java-performance-command-line-tool/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
            <a href="/tags/java-performance/" rel="tag"><i class="fa fa-tag"></i> Java Performance</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/03/kafka-commit-offset/" rel="next" title="Kafka -- 提交位移">
                <i class="fa fa-chevron-left"></i> Kafka -- 提交位移
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/09/05/java-performance-consistency/" rel="prev" title="Java性能 -- 并发一致性">
                Java性能 -- 并发一致性 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/dog.jpg" alt="zhongmingmao">
            
              <p class="site-author-name" itemprop="name">zhongmingmao</p>
              <div class="site-description motion-element" itemprop="description">懦夫从不启程</div>
          </div>

          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:zhongmingmao0625@gmail.com" title="E-Mail &rarr; mailto:zhongmingmao0625@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#free"><span class="nav-number">1.</span> <span class="nav-text">free</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#top"><span class="nav-number">2.</span> <span class="nav-text">top</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vmstat"><span class="nav-number">3.</span> <span class="nav-text">vmstat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pidstat"><span class="nav-number">4.</span> <span class="nav-text">pidstat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU使用率"><span class="nav-number">4.1.</span> <span class="nav-text">CPU使用率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页错误-内存使用率"><span class="nav-number">4.2.</span> <span class="nav-text">页错误 + 内存使用率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IO统计"><span class="nav-number">4.3.</span> <span class="nav-text">IO统计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程上下文切换"><span class="nav-number">4.4.</span> <span class="nav-text">进程上下文切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程上下文切换"><span class="nav-number">4.5.</span> <span class="nav-text">线程上下文切换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jstat"><span class="nav-number">5.</span> <span class="nav-text">jstat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jstack"><span class="nav-number">6.</span> <span class="nav-text">jstack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jmap"><span class="nav-number">7.</span> <span class="nav-text">jmap</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhongmingmao</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">1.9m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">58:48</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.2</div>




        




  <script>
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=61684383";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  













  



  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery_lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fancybox@3/dist/js/jquery.fancybox.pack.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1.1/reading_progress.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  
  
  
    
  

  

  
  
  


  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'e2IMURVDnzc37o6emkTS4i6R-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'e2IMURVDnzc37o6emkTS4i6R-gzGzoHsz',
                'X-LC-Key': 'Vfku3wPjnVYyHe33mjB6bJXY',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script>



  

  
  

  
  

  


  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.scrollToMark('auto', "#更多");
  
  </script>


  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      const selection = document.getSelection();
      const selected = selection.rangeCount > 0 ? selection.getRangeAt(0) : false;
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
      if (selected) {
        selection.removeAllRanges();
        selection.addRange(selected);
      }
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
